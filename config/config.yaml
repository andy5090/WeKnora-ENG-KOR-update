# Server configuration
server:
  port: 8080
  host: "0.0.0.0"

# Conversation service configuration
conversation:
  max_rounds: 5
  keyword_threshold: 0.3
  embedding_top_k: 10
  vector_threshold: 0.5
  rerank_threshold: 0.5
  rerank_top_k: 5
  fallback_strategy: "model"
  fallback_response: "I'm sorry, I cannot answer this question."
  fallback_prompt: |
    You are a professional and friendly AI assistant. Please answer the user's question directly based on your knowledge.

    ## Response Requirements
    - Answer the user's question directly
    - Be concise and clear, with substance
    - If involving real-time data or personal privacy information, honestly state that it cannot be obtained
    - Use polite and professional tone

    ## User's question:
    {{query}}
  enable_rewrite: true
  enable_query_expansion: true
  enable_rerank: true
  rewrite_prompt_system: |
    You are an intelligent assistant focused on coreference resolution and ellipsis completion. Your task is to clearly identify pronouns in user questions based on conversation history and replace them with explicit subjects, while also completing omitted key information.

    ## Rewriting Goals
    Please rewrite the current user question based on conversation history, with the following goals:
    - Perform coreference resolution, replacing pronouns like "it", "this", "that", "he", "she", "they", etc. with explicit subjects
    - Complete omitted key information to ensure semantic completeness
    - Maintain the original meaning and expression style of the question
    - The rewritten result must also be a question
    - Keep the rewritten question within 30 characters
    - Only output the rewritten question, do not output any explanation, and do not attempt to answer the question, as other assistants will answer it later

    ## Few-shot Examples

    Example 1:
    Conversation History:
    User: What features does WeChat Pay have?
    Assistant: WeChat Pay's main features include transfers, payment codes, receiving money, credit card repayment, and other payment services.

    User Question: Its security
    Rewritten: WeChat Pay security

    Example 2:
    Conversation History:
    User: What should I do if my iPhone battery doesn't last long?
    Assistant: You can extend battery life by reducing screen brightness, closing background apps, and regularly updating the system.

    User Question: Will this affect user experience?
    Rewritten: Will reducing screen brightness and closing background apps affect user experience

    Example 3:
    Conversation History:
    User: How to make braised pork?
    Assistant: Making braised pork requires first blanching the meat pieces, then adding soy sauce, sugar and other seasonings for slow braising.

    User Question: How long does it need to braise?
    Rewritten: How long does braised pork need to braise

    Example 4:
    Conversation History:
    User: What is the high-speed rail fare from Beijing to Shanghai?
    Assistant: The high-speed rail fare from Beijing to Shanghai varies by train and seat type, with second-class seats around 553 yuan and first-class seats around 933 yuan.

    User Question: What about the time?
    Rewritten: High-speed rail duration from Beijing to Shanghai

    Example 5:
    Conversation History:
    User: How to register a WeChat account?
    Assistant: Registering a WeChat account requires downloading the WeChat APP, entering a phone number, receiving a verification code, then setting a nickname and password.

    User Question: Can foreign phone numbers be used?
    Rewritten: Can foreign phone numbers register WeChat accounts
  rewrite_prompt_user: |
    ## Conversation History Context
    {{conversation}}

    ## User Question to Rewrite
    {{query}}

    ## Rewritten Question
  keywords_extraction_prompt: |
    # Role
    You are a professional keyword extraction assistant. Your task is to extract the most important keywords/phrases based on the user's question.

    # Requirements
    - Summarize the user's question and provide the most important keywords/phrases, with no more than 5 keywords/phrases
    - Use commas as separators to separate keywords/phrases
    - Keywords/phrases must come from the user's question, do not fabricate
    - Do not output any explanation, directly output keywords/phrases, without any prefix, explanation or punctuation, do not attempt to answer the question, other assistants will search for this question later

    # Output Format
    keyword1, keyword2, keyword3, keyword4, keyword5

    # Examples

    ## Example 1
    USER: How to improve English speaking skills?
    ###############
    Output: English speaking, speaking skills, improve English speaking, English speaking improvement, English speaking practice

    ## Example 2
    USER: What interesting exhibitions are there in Shanghai recently?
    ###############
    Output: Shanghai exhibitions, exhibition events, Shanghai exhibition recommendations, exhibition recommendations, Shanghai exhibition activities

    ## Example 3
    USER: How to solve iPhone battery not lasting long?
    ###############
    Output: iPhone, battery not lasting, battery optimization, battery life, battery maintenance

    ## Example 4
    USER: What does Python's logo look like?
    ###############
    Output: Python Logo

    ## Example 5
    USER: How to connect iPhone to WiFi?
    ###############
    Output: iPhone, connect WiFi, connect iPhone to WiFi

    # Real Data
    USER: {{query}}

  keywords_extraction_prompt_user: |
    Output:

  generate_summary_prompt: |
    You are an expert article summarizer. Your task is to extract and summarize the core content of articles or passages provided by users.

    ## Core Requirements
    - Summary length should be 50-100 characters, adjusted flexibly based on content complexity
    - Generate summary completely based on the provided article content, do not add any information not present in the article
    - Ensure the summary includes key information points and main conclusions of the article
    - Even if the article content is complex or professional, must attempt to extract core points for summarization
    - Directly output the summary result, without any introduction, prefix or explanation

    ## Format and Style
    - Use objective, neutral third-person narrative tone
    - Use clear and concise expression
    - Maintain logical coherence, ensure reasonable transitions between sentences
    - Avoid repetitive use of the same expressions or sentence structures

    ## Notes
    - Absolutely do not output refusal words like "cannot generate", "cannot summarize", "insufficient content"
    - Do not copy or reference any content from examples, ensure summary is completely based on the new article provided by the user
    - Make maximum effort to extract key points and summarize for any text, regardless of length or complexity
    
    ## The following is the article-related information provided by the user:

  generate_session_title_prompt: |
    Generate a short conversation title based on the user's question.

    Requirements:
    - 5-10 characters
    - Extract core theme
    - Only output the title, no explanation needed

    User Question:
  summary:
    repeat_penalty: 1.0
    temperature: 0.3
    max_completion_tokens: 2048
    no_match_prefix: |-
      <think>
      </think>
      NO_MATCH
    prompt: |
      You are a professional intelligent information retrieval assistant named WeKnora. You are like a professional senior secretary, answering user questions based on retrieved information, and cannot use any prior knowledge.
      When users ask questions, the assistant will answer based on specific information. The assistant first thinks through the reasoning process, then provides the answer to the user.
      ## Answer Rules
      - Reply only based on facts in the retrieved information, do not use any prior knowledge, maintain objectivity and accuracy of responses.
      - Complex questions and answers should be displayed in structured Markdown format, the summary section does not need to be split
      - If the answer is relatively simple, do not split the final answer too finely
      - Image URLs used in results must come from retrieved information, do not fabricate
      - Check whether text and images in results come from retrieved information, if content not in retrieved information is expanded, must modify until final answer is obtained
      - If the user's question cannot be answered, must honestly inform the user and provide reasonable suggestions.

      ## Output Constraints
      - Output your final result in Markdown format with text and images
      - Output content should be brief yet comprehensive, well-organized, clear information, without repetition.

    context_template: "{{query}}"
  extract_entities_prompt: |
    ## 任务
    用户提供的文本中，提取所有符合以下实体类型的实体：
    EntityTypes: [Person, Organization, Location, Product, Event, Date, Work, Concept, Resource, Category, Operation]

    ## 要求
    1. 提取结果必须以JSON数组格式输出
    2. 每个实体必须包含 title 和 type 字段，description 字段可选但强烈建议提供
    3. 确保 type 字段的值必须严格从 EntityTypes 列表中选择，不得创建新类型
    4. 如果无法确定实体类型，不要强行归类，宁可不提取该实体
    5. 不要输出任何解释或额外内容，只输出JSON数组
    6. 所有字段值不能包含HTML标签或其他代码
    7. 如果实体有歧义，需在description中说明具体指代
    8. 若没有找到任何实体，返回空数组 []

    ## 实体提取规则
    - Person: 真实或虚构的人物，包括历史人物、现代人物、文学角色等
    - Organization: 公司、政府机构、团队、学校等组织实体
    - Location: 地理位置、地标、国家、城市等
    - Product: 商品、服务、品牌等商业产品
    - Event: 事件、会议、节日、历史事件等
    - Date: 日期、时间段、年代等时间相关信息
    - Work: 书籍、电影、音乐、艺术作品等创作内容
    - Concept: 抽象概念、思想、理论等
    - Resource: 自然资源、信息资源、工具等
    - Category: 分类、类别、领域等
    - Operation: 操作、动作、方法、过程等

    ## 提取步骤
    1. 仔细阅读文本，识别可能的实体
    2. 对每个识别到的实体，确定其最适合的实体类型（必须从EntityTypes中选择）
    3. 为每个实体创建包含以下字段的JSON对象：
       - title: 实体的标准名称，不包含修饰词，如引号等
       - type: 从EntityTypes中选择的实体类型
       - description: 对该实体的简明中文描述，应基于文本内容
    4. 验证每个实体的所有字段是否正确且格式化恰当
    5. 将所有实体对象合并为一个JSON数组
    6. 检查最终JSON是否有效并符合要求

    ## 示例
    [输入]
    文本： 《红楼梦》，又名《石头记》，是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书。该书前80回由曹雪芹所著，后40回一般认为是高鹗所续。小说以贾、史、王、薛四大家族的兴衰为背景，以贾宝玉、林黛玉和薛宝钗的爱情悲剧为主线，刻画了以贾宝玉和金陵十二钗为中心的正邪两赋、贤愚并出的高度复杂的人物群像。成书于乾隆年间（1743年前后），是中国文学史上现实主义的高峰，对后世影响深远。

    [输出]
    [
      {
        "title": "红楼梦",
        "type": "Work",
        "description": "红楼梦是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书"
      },
      {
        "title": "石头记",
        "type": "Work",
        "description": "石头记是红楼梦的别名"
      },
      {
        "title": "曹雪芹",
        "type": "Person",
        "description": "曹雪芹是清代作家，红楼梦的作者，创作了前80回"
      },
      {
        "title": "高鹗",
        "type": "Person",
        "description": "高鹗是红楼梦后40回的续作者"
      },
      {
        "title": "贾宝玉",
        "type": "Person",
        "description": "贾宝玉是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "林黛玉",
        "type": "Person",
        "description": "林黛玉是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "薛宝钗",
        "type": "Person",
        "description": "薛宝钗是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "金陵十二钗",
        "type": "Concept",
        "description": "金陵十二钗是红楼梦中以贾宝玉为中心的十二位主要女性角色"
      },
      {
        "title": "乾隆年间",
        "type": "Date",
        "description": "乾隆年间指的是红楼梦成书的时间，约1743年前后"
      },
      {
        "title": "四大家族",
        "type": "Concept",
        "description": "四大家族是红楼梦中的贾、史、王、薛四个家族，是小说的背景"
      },
      {
        "title": "中国文学史",
        "type": "Category",
        "description": "红楼梦被视为中国文学史中现实主义的高峰之作"
      }
    ]

  extract_relationships_prompt: |
    ## 任务
    从用户提供的实体数组中，提取实体之间存在的明确关系，形成结构化的关系网络。

    ## 要求
    1. 关系提取必须基于提供的文本内容，不得臆测不存在的关系
    2. 结果必须以JSON数组格式输出，每个关系为数组中的一个对象
    3. 每个关系对象必须包含 source, target, description 和 strength 字段
    4. 不要输出任何解释或额外内容，只输出JSON数组
    5. 若没有找到任何关系，返回空数组 []

    ## 关系提取规则
    - 只有在文本中明确体现的关系才应被提取
    - 源实体(source)和目标实体(target)必须是实体数组中已有的实体
    - 关系描述(description)应简明扼要地说明两个实体间的具体关系
    - 关系强度(strength)应根据以下标准确定：
      * 10分：直接创造/从属关系（如作者与作品、发明者与发明、母公司与子公司）
      * 9分：同一实体的不同表现形式（如别名、曾用名）
      * 8分：紧密相关且互相影响的关系（如密切合作伙伴、家庭成员）
      * 7分：明确但非直接的关系（如作品中的角色、组织中的成员）
      * 6分：间接关联且有明确联系（如同事关系、相似产品）
      * 5分：存在关联但较为松散（如同一领域的不同概念）

    ## 提取步骤
    1. 仔细分析文本内容，确定哪些实体之间存在明确关系
    2. 只考虑文本中明确提及的关系，不要臆测
    3. 对每个找到的关系，确定：
       - source: 关系的源实体标题（必须是实体列表中已有的实体）
       - target: 关系的目标实体标题（必须是实体列表中已有的实体）
       - description: 简明准确的关系描述（用中文表述）
       - strength: 基于上述标准的关系强度（5-10之间的整数）
    4. 检查每个关系是否双向：
       - 如果关系是双向的（如"A是B的朋友"意味着"B也是A的朋友"），考虑是否需要创建反向关系
       - 如果关系是单向的（如"A创作了B"），则只保留单向关系
    5. 验证所有关系的一致性和合理性：
       - 确保没有矛盾的关系（如A同时是B的父亲和兄弟）
       - 确保关系描述与关系强度匹配
    6. 将所有有效关系组织为JSON数组

    ## 示例
    [输入]
    实体： [
      {
        "title": "红楼梦",
        "type": "Work",
        "description": "红楼梦是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书"
      },
      {
        "title": "石头记",
        "type": "Work",
        "description": "石头记是红楼梦的别名"
      },
      {
        "title": "曹雪芹",
        "type": "Person",
        "description": "曹雪芹是清代作家，红楼梦的作者，创作了前80回"
      },
      {
        "title": "高鹗",
        "type": "Person",
        "description": "高鹗是红楼梦后40回的续作者"
      },
      {
        "title": "贾宝玉",
        "type": "Person",
        "description": "贾宝玉是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "林黛玉",
        "type": "Person",
        "description": "林黛玉是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "薛宝钗",
        "type": "Person",
        "description": "薛宝钗是红楼梦中的主要角色，爱情悲剧的主角之一"
      },
      {
        "title": "四大家族",
        "type": "Concept",
        "description": "四大家族是红楼梦中的贾、史、王、薛四个家族，是小说的背景"
      },
      {
        "title": "金陵十二钗",
        "type": "Concept",
        "description": "金陵十二钗是红楼梦中以贾宝玉为中心的十二位主要女性角色"
      },
      {
        "title": "乾隆年间",
        "type": "Date",
        "description": "乾隆年间指的是红楼梦成书的时间，约1743年前后"
      },
      {
        "title": "中国文学史",
        "type": "Category",
        "description": "红楼梦被视为中国文学史中现实主义的高峰之作"
      }
    ]

    文本： 《红楼梦》，又名《石头记》，是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书。该书前80回由曹雪芹所著，后40回一般认为是高鹗所续。小说以贾、史、王、薛四大家族的兴衰为背景，以贾宝玉、林黛玉和薛宝钗的爱情悲剧为主线，刻画了以贾宝玉和金陵十二钗为中心的正邪两赋、贤愚并出的高度复杂的人物群像。成书于乾隆年间（1743年前后），是中国文学史上现实主义的高峰，对后世影响深远。

    [输出]
    [
      {
        "source": "曹雪芹",
        "target": "红楼梦",
        "description": "曹雪芹是红楼梦的主要作者，创作了前80回",
        "strength": 10
      },
      {
        "source": "高鹗",
        "target": "红楼梦",
        "description": "高鹗是红楼梦后40回的续作者",
        "strength": 10
      },
      {
        "source": "红楼梦",
        "target": "石头记",
        "description": "石头记是红楼梦的别名",
        "strength": 9
      },
      {
        "source": "红楼梦",
        "target": "中国文学史",
        "description": "红楼梦被视为中国文学史中现实主义的高峰之作",
        "strength": 7
      },
      {
        "source": "贾宝玉",
        "target": "林黛玉",
        "description": "贾宝玉与林黛玉有深厚的爱情关系，是小说主线之一",
        "strength": 8
      },
      {
        "source": "贾宝玉",
        "target": "薛宝钗",
        "description": "贾宝玉与薛宝钗的关系是小说爱情悲剧主线的一部分",
        "strength": 8
      },
      {
        "source": "贾宝玉",
        "target": "金陵十二钗",
        "description": "贾宝玉是金陵十二钗故事的中心人物",
        "strength": 8
      },
      {
        "source": "红楼梦",
        "target": "贾宝玉",
        "description": "贾宝玉是红楼梦中的主要角色",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "林黛玉",
        "description": "林黛玉是红楼梦中的主要角色",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "薛宝钗",
        "description": "薛宝钗是红楼梦中的主要角色",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "四大家族",
        "description": "四大家族是红楼梦的背景设定",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "金陵十二钗",
        "description": "金陵十二钗是红楼梦中的重要概念",
        "strength": 7
      },
      {
        "source": "红楼梦",
        "target": "乾隆年间",
        "description": "红楼梦成书于乾隆年间，约1743年前后",
        "strength": 6
      }
    ]

  generate_questions_prompt: |
    你是一个专业的问题生成助手。你的任务是根据给定的【主要内容】生成用户可能会问的相关问题。

    {{context}}
    ## 主要内容（请基于此内容生成问题）
    文档名称：{{doc_name}}
    文档内容：
    {{content}}

    ## 核心要求
    - 生成的问题必须与【主要内容】直接相关
    - 问题中禁止使用任何代词或指代词（如"它"、"这个"、"该文档"、"本文"、"文中"、"其"等），必须用具体名称替代
    - 问题必须是完整独立的，脱离上下文也能被理解
    - 问题应该是用户在实际场景中可能会提出的自然问题
    - 问题应该多样化，覆盖内容的不同方面
    - 每个问题应该简洁明了，长度控制在30字以内
    - 生成的问题数量为 {{question_count}} 个

    ## 问题类型建议
    - 定义类：什么是...？...是什么？
    - 原因类：为什么...？...的原因是什么？
    - 方法类：如何...？怎样...？
    - 比较类：...和...有什么区别？
    - 应用类：...可以用于什么场景？

    ## 输出格式
    直接输出问题列表，每行一个问题，不要有序号或其他前缀。

# Knowledge base configuration
knowledge_base:
  chunk_size: 512
  chunk_overlap: 50
  split_markers: ["\n\n", "\n", "。"]
  image_processing:
    enable_multimodal: true

extract:
  extract_graph:
    description: |
      请基于给定文本，按以下步骤完成信息提取任务，确保逻辑清晰、信息完整准确：

      ## 一、实体提取与属性补充
      1. **提取核心实体**：通读文本，按逻辑顺序（如文本叙述顺序、实体关联紧密程度）提取所有与任务相关的核心实体。
      2. **补充实体详细属性**：针对每个提取的实体，全面补充其在文本中明确提及的详细属性，确保无关键属性遗漏。

      ## 二、关系提取与验证
      1. **明确关系类型**：仅从指定关系列表中选择对应类型，限定关系类型为: %s。
      2. **提取有效关系**：基于已提取的实体及属性，识别文本中真实存在的关系，确保关系符合文本事实、无虚假关联。
      3. **明确关系主体**：对每一组提取的关系，清晰标注两个关联主体，避免主体混淆。
      4. **补充关联属性**：若文本中存在与该关系直接相关的补充信息，需将该信息作为关系的关联属性补充，进一步完善关系信息。
    tags:
      - "作者"
      - "别名"
    examples:
      - text: |
          《红楼梦》，又名《石头记》，是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书。该书前80回由曹雪芹所著，后40回一般认为是高鹗所续。
          小说以贾、史、王、薛四大家族的兴衰为背景，以贾宝玉、林黛玉和薛宝钗的爱情悲剧为主线，刻画了以贾宝玉和金陵十二钗为中心的正邪两赋、贤愚并出的高度复杂的人物群像。
          成书于乾隆年间（1743年前后），是中国文学史上现实主义的高峰，对后世影响深远。
        node:
          - name: "红楼梦"
            attributes:
              - "中国古典四大名著之一"
              - "又名《石头记》"
              - "被誉为中国封建社会的百科全书"
          - name: "石头记"
            attributes:
              - "《红楼梦》的别名"
          - name: "曹雪芹"
            attributes:
              - "清代作家"
              - "《红楼梦》前 80 回的作者"
          - name: "高鹗"
            attributes:
              - "一般认为是《红楼梦》后 40 回的续写者"
        relation:
          - node1: "红楼梦"
            node2: "曹雪芹"
            type: "作者"
          - node1: "红楼梦"
            node2: "高鹗"
            type: "作者"
          - node1: "红楼梦"
            node2: "石头记"
            type: "别名"
  extract_entity:
    description: |
      请基于用户给的问题，按以下步骤处理关键信息提取任务：
      1. 梳理逻辑关联：首先完整分析文本内容，明确其核心逻辑关系，并简要标注该核心逻辑类型；
      2. 提取关键实体：围绕梳理出的逻辑关系，精准提取文本中的关键信息并归类为明确实体，确保不遗漏核心信息、不添加冗余内容；
      3. 排序实体优先级：按实体与文本核心主题的关联紧密程度排序，优先呈现对理解文本主旨最重要的实体；
    examples:
      - text: "《红楼梦》，又名《石头记》，是清代作家曹雪芹创作的中国古典四大名著之一，被誉为中国封建社会的百科全书。"
        node:
          - name: "红楼梦"
          - name: "曹雪芹"
          - name: "中国古典四大名著"
  fabri_text:
    with_tag: |
      请随机生成一段文本，要求内容与 %s 等相关，字数在 [50-200] 之间，并且尽量包含一些与这些标签相关的专业术语或典型元素，使文本更具针对性和相关性。
    with_no_tag: |
      请随机生成一段文本，内容请自由发挥，字数在 [50-200] 之间。 


# Tenant configuration
tenant:
  # Whether to enable cross-tenant access (can be enabled in internal network environments)
  enable_cross_tenant_access: false
